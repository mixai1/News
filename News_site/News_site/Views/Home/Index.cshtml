@model IndexNewsModel
@{
    ViewData["Title"] = "Home Page";
}
<script src="https://code.jquery.com/jquery-2.2.4.min.js"
        integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44="
        crossorigin="anonymous"></script>


@if (Model.News.Count() == 0)
{
    <h1>No news now</h1>
}

else
{
    @foreach (var news in Model.News)
    {
        <div class="col xl m6">
            <div class="card" asp-route-id="@news.Id">
                <div class="card-image">
                    <img src="https://materializecss.com/images/sample-1.jpg">
                    <span class="card-title">@news.Heading</span>
                </div>
                <div class="card-content">
                    <p>@news.Content </p>
                </div>
                <div class="card-content" id="result_@news.Id"></div>
                <div class="card-action">
                    <form asp-action="Delete" asp-controller="News" asp-route-id="@news.Id" method="post">
                        @if (User.IsInRole("admin"))
                        {
                            <button type="submit" class="btn btn-sm btn-danger">Delete </button>
                        }
                    </form>
                    <form style="display:none" id="form_@news.Id" onsubmit="return false">
                        <textarea id="textarea_@news.Id" name="comment"></textarea>
                        <button id="add_@news.Id" class="btn btn-sm btn-danger">Add</button>
                    </form>
                    <a class="btn btn-sm btn-primary" id="add_comment_@news.Id" onclick="return false">Add Comment </a><br />
                    <a class="btn btn-sm btn-primary" style="display:none" id="back_@news.Id" onclick="return false">Back</a>
                </div>
            </div>
        </div>

        <script type="text/javascript">
            $(document).ready(function () {
                $(document).on('click', '#add_comment_@news.Id', function () {
                    var forms = $('#form_@news.Id').css('display', 'block');
                    $('#back_@news.Id').css('display', 'block');
                    $('#add_comment_@news.Id').css('display', 'none');
                });
                $('#add_@news.Id').click(function () {
                    var comment = $('#textarea_@news.Id').val();
                    $.ajax({
                            method: 'POST',
                            contentType: "application/json",
                            async: true,
                            url: 'https://localhost:5001/Comment/AddComment',
                            dataType: "json",
                            data: JSON.stringify({
                                Body: comment
                            }),
                            success: function (response) {
                                $('#result_@news.Id').append('<p class="flow-text">'+"@User.Identity.Name"+" : " + response + '</p>');
                                $('#textarea_@news.Id').val('');
                            },
                            error: function () {
                                alert('Error');
                            }
                        });
                    });
                $('#back_@news.Id').click(function () {
                    $('#form_@news.Id').css('display', 'none');
                    $('#back_@news.Id').css('display', 'none');
                    $('#add_comment_@news.Id').css('display', 'block');
                });
            });
        </script>


    }
}

<a class="btn btn-sm btn-primary" asp-controller="News" asp-action="AddNews">Add News</a>
<div class="text-center">
    <p> Good News Site,2019</p>
</div>


